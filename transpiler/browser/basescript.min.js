!function(){class t{static #a=["nothing","null","string","integer","real","boolean","object","globals","endglobals","function","endfunction","await","takes","returns","do","enddo","local","const","set","return","if","then","else","elseif","endif","loop","exitwhen","endloop","call"];#b=[];#c(e){return/^\d+$/.test(e)}#d(s){return/[A-Za-z0-9_]+/.test(s)}#e(r){return t.#a.includes(r.toLowerCase())}#f(i){return/^[+*\/-=.,<>]+$/.test(i)}tokenize(t){let e="";for(let s=0;s<t.length;s++){if("\n"===(e+=t[s])||"\r\n"===e){this.#b.push({type:"EOL"}),e="";continue}e=e.trim();let r=t[s+1];if('"'===e){let i='"';for(s++;'"'!==t[s];)i+=t[s],s++;i+=t[s],this.#b.push({type:"STRING",value:i}),e="";continue}if(this.#c(e)&&!this.#c(r)){this.#b.push({type:"NUMBER",value:e}),e="";continue}if("("===e||")"===e){"("===e?this.#b.push({type:"LPAREN"}):this.#b.push({type:"RPAREN"}),e="";continue}if("{"===e||"}"===e){"{"===e?this.#b.push({type:"LBRACE"}):this.#b.push({type:"RBRACE"}),e="";continue}if(this.#d(e)&&!this.#d(r)){this.#e(e)?this.#b.push({type:"KEYWORD",value:e}):this.#b.push({type:"IDENTIFIER",value:e}),e="";continue}this.#f(e)&&!this.#f(r)&&(this.#b.push({type:"OPERATOR",value:e}),e="")}return this.#b.push({type:"EOF"}),this.#b}}class a{#b=[];#g=0;#h=[];#i=[];#j=void 0;#k=5;constructor(t){this.#b=t??[],this.#i=this.#h}reset(t){this.#b=t,this.#i=[]}#l(n=1){this.#g+=n}#m(h=1){return this.#b[this.#g+h]}get #n(){return this.#b[this.#g+1].type}get #o(){return this.#b[this.#g+1].value}#p(){return this.#b[this.#g]}get #q(){return this.#b[this.#g].type}get #r(){return this.#b[this.#g].value}#s(o){Array.isArray(this.#i)?this.#i.push(o):this.#i.body.push(o)}#t(){let l={type:"GlobalsDeclaration",body:[],parent:this.#i};this.#l(),this.#i=l,this.parse("KEYWORD","endglobals"),this.#i=l.parent,this.#l(),this.#s(l)}#u(){let c={type:"VariableDeclaration",name:"",mutable:!0,varType:"",body:[],parent:this.#i};"KEYWORD"===this.#n&&"const"===this.#o.toLowerCase()&&(this.#l(),c.mutable=!1),this.#l(),c.varType=this.#r,this.#l(),c.name=this.#r,"OPERATOR"===this.#m().type&&"="===this.#m().value?.toLowerCase()&&(this.#l(2),this.#i=c,this.parse("EOL"),this.#i=c.parent),this.#l(),this.#s(c)}#v(){let p={type:"FunctionDeclaration",name:"",body:[],parameters:[],returns:void 0,async:!1,parent:this.#i};if(this.#j=p,this.#l(),"KEYWORD"===this.#q&&"takes"===this.#r.toLowerCase())this.#l();else if("IDENTIFIER"===this.#q&&"KEYWORD"===this.#n&&"takes"===this.#o.toLowerCase())p.name=this.#r,this.#l(2);else{this.#w();return}p.parameters=this.#x(),this.#l(),p.returns=this.#r,this.#l(),this.#i=p,this.parse("KEYWORD","endfunction"),this.#l(),this.#i=p.parent,this.#s(p),this.#j=void 0}#x(){let u=[];for(;"KEYWORD"!==this.#m().type&&"returns"!==this.#m().value?.toLowerCase();)u.push(this.#r),this.#l();return u.push(this.#r),this.#l(),u}#y(){let d={type:"DoExpression",async:!1,body:[],parent:this.#i},g=this.#j;this.#j=d,this.#l(),this.#i=d,this.parse("KEYWORD","enddo"),this.#l(),this.#i=d.parent,this.#s(d),this.#j=g}#z(){let f={type:"SetExpression",name:"",body:[],parent:this.#i};this.#l(),f.name=this.#r,this.#l(2),this.#i=f,this.parse("EOL"),this.#i=f.parent,this.#l(),this.#s(f)}#A(){let E={type:"ReturnExpression",name:""};this.#l(),E.name=this.#r,this.#l(),this.#s(E)}#B(){let x={type:"IfStatement",test:[],then:[],else:void 0,parent:this.#i};this.#l(),this.#i=x.test,this.parse("KEYWORD","then"),this.#i=x.parent,this.#l(2),this.#i=x.then;let{endValue:y}=this.parse("KEYWORD",["endif","else"]);"else"===y&&(this.#l(),x.else=[],this.#i=x.else,this.parse("KEYWORD","endif")),this.#l(),this.#i=x.parent,this.#s(x)}#C(S=!1){let w={type:"CallExpression",name:"",async:!1,body:[],parent:this.#i};S||this.#l(),"KEYWORD"===this.#q&&"await"===this.#r.toLowerCase()&&(w.async=!0,this.#j&&(this.#j.async=!0),this.#l()),w.name=this.#r,this.#l(2),this.#i=w,this.parse("RPAREN"),this.#i=w.parent,this.#l(),this.#s(w)}#D(){let m={type:"StaticValue",name:""};return m.name=this.#r,m}#w(){let v={type:"FunctionReference",name:""};v.name=this.#r,this.#l(),this.#s(v)}#E(){let k={type:"LoopStatement",exitwhen:void 0,body:[],parent:this.#i};this.#l(),this.#i=k,this.parse("KEYWORD","endloop"),this.#l(),this.#i=k.parent,this.#s(k)}#F(){let b={type:"ExitwhenExpression",body:[],parent:this.#i};this.#l(),this.#i=b,this.parse("EOL"),this.#i=b.parent,this.#i.exitwhen=b}#G(){let A={type:"Number",value:""};A.value=this.#r,this.#l(),this.#s(A)}#H(){if("//"===this.#r){let D={type:"Comment",body:[]};this.#l();let L=this.#i;this.#i=D,this.parse("EOL"),this.#i=L,this.#s(D);return}let T={type:"Operator",value:""};T.value=this.#r,this.#l(),this.#s(T)}#I(){let R={type:"Identifier",value:""};if("LPAREN"===this.#n){this.#C(!0);return}R.value=this.#r,this.#l(),this.#s(R)}#J(){let $={type:"String",value:""};$.value=this.#r,this.#l(),this.#s($)}#K(){switch(this.#r.toLowerCase()){case"globals":this.#t();break;case"function":this.#v();break;case"do":this.#y();break;case"local":this.#u();break;case"set":this.#z();break;case"return":this.#A();break;case"if":this.#B();break;case"call":this.#C();break;case"loop":this.#E();break;case"exitwhen":this.#F()}}parse(t="EOF",e,s=!0){for(;this.#q!==t||(Array.isArray(e)?!e.includes(this.#r?.toLocaleLowerCase()):this.#r?.toLowerCase()!==e);){if(this.#k<=0)return;if(s&&"EOL"===this.#q){this.#l();continue}switch(this.#q){case"KEYWORD":this.#K();break;case"NUMBER":this.#G();break;case"OPERATOR":this.#H();break;case"IDENTIFIER":this.#I();break;case"STRING":this.#J();break;default:this.#k--}}return{ast:this.#i,endType:this.#q,endValue:this.#r}}}let C={};C.ToInteger=function(t){return Number.parseInt(t)},C.ToFloat=function(t){return Number.parseFloat(t)},C.ToString=function(t){return t?.toString()??""},C.ToBoolean=function(t){return Boolean(t)},C.I2S=function(t){return t.toString()},C.S2I=function(t){return Number.parseInt(t)},C.SubString=function(t,e,s){return t.substring(e,s)},C.StringLength=function(t){return t.length},C.Assert=function(t,e){if(!t)throw Error(e)},C.Byte=function(t){return new TextEncoder().encode(t)},C.Char=function(t){return t.charCodeAt(0)},C.Find=function(t,e){return e.find(e=>e===t)},C.TypeOf=function(t){return Object.prototype.toString.call(t)},C.Pairs=function(t){return Object.entries(t)},C.Add=function(t,e){return t+e},C.Sub=function(t,e){return t-e},C.Mul=function(t,e){return t*e},C.Div=function(t,e){return t/e},C.Pow=function(t,e){return Math.pow(t,e)},C.Print=function(t){console.log(t)},C.Log=function(t){console.log(t)},C.Info=function(t){console.info(t)},C.Array=function(...t){return[...t]},C.Length=function(t){return t?.length??0},C.At=function(t,e){return t[e]},C.Upper=function(t){return t.toUpperCase()},C.Lower=function(t){return t.toLowerCase()},C.ForEach=function(t,e){for(let s of t)e(s)},C.WriteClipboard=async function(t){return window.clipboard.writeText(t)},C.ReadClipboard=async function(){return window.clipboard.readText()},C.Alert=function(t){alert(t)},C.Confirm=function(t){return confirm(t)},C.Fetch=async function(t){return fetch(t)},C.FetchJson=async function(t){return fetch(t).then(t=>t.json())},C.FetchText=async function(t){return fetch(t).then(t=>t.text())},C.QuerySelector=function(t,e=document){return e.querySelector(t)},C.QuerySelectorAll=function(t,e=document){return Array.from(e.querySelectorAll(t))},C.SetAttr=function(t,e,s){"string"==typeof t&&(t=Array.from(document.querySelectorAll(t)));let r=[t].flat();for(let i of r)i.setAttribute(e,s)},C.GetAttr=function(t,e){return("string"==typeof t&&(t=Array.from(document.querySelectorAll(t))),Array.isArray(t))?t[0].getAttribute(e):t.getAttribute(e)},C.SetProp=function(t,e,s){"string"==typeof t&&(t=Array.from(document.querySelectorAll(t)));let r=[t].flat();for(let i of r)i[e]=s},C.GetProp=function(t,e){return("string"==typeof t&&(t=Array.from(document.querySelectorAll(t))),Array.isArray(t))?t[0][e]:t[e]},C.SetHtml=function(t,e){"string"==typeof t&&(t=Array.from(document.querySelectorAll(t)));let s=[t].flat();for(let r of s)r.innerHTML=e},C.GetHtml=function(t){return("string"==typeof t&&(t=Array.from(document.querySelectorAll(t))),Array.isArray(t))?t[0].innerHTML:t.innerHTML},C.SetText=function(t,e){"string"==typeof t&&(t=Array.from(document.querySelectorAll(t)));let s=[t].flat();for(let r of s)r.textContent=e},C.GetText=function(t){return("string"==typeof t&&(t=Array.from(document.querySelectorAll(t))),Array.isArray(t))?t[0].textContent:t.textContent},C.Siblings=function(t){return"string"==typeof t&&(t=document.querySelector(t)),[...t.parentNode.children].filter(e=>e!==t)},C.HasClass=function(t,e){return("string"==typeof t&&(t=Array.from(document.querySelectorAll(t))),Array.isArray(t))?t[0].classList.contains(e):t.classList.contains(e)},C.AddClass=function(t,e){"string"==typeof t&&(t=Array.from(document.querySelectorAll(t)));let s=[t].flat();for(let r of s)r.classList.add(...e)},C.RemoveClass=function(t,e){"string"==typeof t&&(t=Array.from(document.querySelectorAll(t)));let s=[t].flat();for(let r of s)r.classList.remove(...e)},C.ToggleClass=function(t,e){"string"==typeof t&&(t=Array.from(document.querySelectorAll(t)));let s=[t].flat();for(let r of s)r.classList.toggle(e)},C.On=function(t,e,s){"string"==typeof t&&(t=Array.from(document.querySelectorAll(t)));let r=[t].flat();for(let i of r)i.addEventListener(e,s)},C.OnClick=function(t,e){"string"==typeof t&&(t=Array.from(document.querySelectorAll(t)));let s=[t].flat();for(let r of s)r.addEventListener("click",e)},C.Delegate=function(t,e,s,r){"string"==typeof t&&(t=Array.from(document.querySelectorAll(t)));let i=[t].flat();for(let a of i)a.addEventListener(s,t=>{t.target.closest(e)&&r.call(t.target,t)})};class O{static #L=Object.keys(C);#M=[];#N={};#O={};#P=[];#i=[];#Q=0;#R="";#S=!0;#T=!0;#U=0;#V=0;#W=[];#X=0;#Y="";constructor(t){this.#M=t,this.#i=this.#M}#Z(){for(let _=0;_<this.#Q;_++)this.#Y+="  "}globalsDeclaration(){}functionDeclaration(){this.#S&&this.#Z(),this.#Y+=`/** @returns {${"nothing"===this.#i.returns?"void":this.#i.returns}} */ `,this.#i.async&&(this.#Y+="async "),this.#Y+=`function ${this.#i.name}(`,this.#i.parameters.filter(t=>"nothing"!==t).forEach((t,e,s)=>{if(e<s.length-1){this.#Y+=`${t}, `;return}this.#Y+=t}),this.#Y+=") {\n";let t=this.#i;this.#i=this.#i.body,this.#Q++;let e=this.#S,s=this.#T,r=this.#X;this.#S=!0,this.#T=!0,this.#X=0,this.walk(),this.#S=e,this.#T=s,this.#X=r,this.#Q--,this.#i=t,this.#Z(),this.#Y+=`}${this.#X>0?"":"\n"}`}variableDeclaration(){this.#Z(),this.#i.mutable?this.#Y+="let ":this.#Y+="const ",this.#Y+=`/** @type {${this.#i.varType}} */ ${this.#i.name} = `;let t=this.#i;this.#i=this.#i.body,this.#R=" ",this.#S=!1,this.#T=!1,this.walk(),this.#R="",this.#S=!0,this.#T=!0,this.#i=t,this.#Y+=";\n"}ifStatement(){this.#Z(),this.#Y+="if (";let t=this.#i;this.#i=this.#i.test;let e=this.#S,s=this.#T;this.#S=!1,this.#T=!1,this.walk(),this.#S=e,this.#T=s,this.#i=t,this.#Y+=") {\n",this.#i=this.#i.then,this.#Q++,this.walk(),this.#Q--,this.#i=t,this.#i.else&&(this.#Z(),this.#Y+="} else {\n",t=this.#i,this.#i=this.#i.else,this.#Q++,this.walk(),this.#Q--,this.#i=t),this.#Z(),this.#Y+="}\n"}setExpression(){this.#Z(),this.#Y+=`${this.#i.name} = `;let t=this.#i;this.#i=this.#i.body,this.#R=" ",this.#S=!1,this.#T=!1,this.walk(),this.#R="",this.#S=!0,this.#T=!0,this.#i=t,this.#Y+=";\n"}callExpression(){this.#S&&this.#Z(),O.#L.includes(this.#i.name)&&(this.#W.push(this.#i.name),this.#i.name=`__${this.#i.name}`),this.#i.async&&(this.#Y+="await "),this.#Y+=`${this.#i.name}(`;let t=this.#i;this.#i=this.#i.body;let e=this.#S,s=this.#T;this.#R=", ",this.#S=!1,this.#T=!1,this.#X++,this.walk(),this.#i=t,this.#R="",this.#S=e,this.#T=s,this.#X--,this.#Y+=")",this.#T&&0===this.#X&&(this.#Y+=";\n")}staticValue(){this.#Y+=this.#i.name,this.#R&&this.#U<this.#V-1&&(this.#Y+=this.#R)}functionReference(){this.#Y+=`${this.#i.name}`,this.#R&&this.#U<this.#V-1&&(this.#Y+=this.#R)}loopStatement(){this.#Z(),this.#Y+="while (!(";let t=this.#i;this.#i=this.#i.exitwhen.body;let e=this.#S,s=this.#T;this.#S=!1,this.#T=!1,this.walk(),this.#S=e,this.#T=s,this.#i=t,this.#Y+=")) {\n",t=this.#i,this.#i=this.#i.body,this.#Q++,this.walk(),this.#Q--,this.#i=t,this.#Z(),this.#Y+="}\n"}doExpression(){this.#S&&this.#Z(),this.#Y+="(",this.#i.async&&(this.#Y+="async "),this.#Y+="function() {\n";let t=this.#i;this.#i=this.#i.body,this.#Q++,this.walk(),this.#Q--,this.#i=t,this.#Z(),this.#Y+="})()"}returnExpression(){this.#Z(),this.#Y+=`return ${this.#i.name};
`}number(){this.#Y+=this.#i.value,this.#R&&this.#U<this.#V-1&&(this.#Y+=" ")}string(){this.#Y+=this.#i.value,this.#U<this.#V-1&&(this.#Y+=" ")}identifier(){this.#Y+=this.#i.value,this.#U<this.#V-1&&this.#O?.value!=="->"&&(this.#Y+=" ")}operator(){if("->"===this.#i.value){this.#Y+=".";return}this.#Y+=this.#i.value,this.#U<this.#V-1&&(this.#Y+=" ")}comment(){this.#S&&this.#Z(),this.#Y+=`// ${this.#i.body.map(t=>t.value??"").join(" ")}
`}walk(){for(let t of(this.#V=this.#i.length,this.#U=0,this.#P=this.#i,this.#i))this.#N={type:void 0,value:void 0},this.#O={type:void 0,value:void 0},this.#N=this.#P[this.#U-1],this.#O=this.#P[this.#U+1],this.#i=t,this[`${t.type.slice(0,1).toLowerCase()}${t.type.slice(1)}`](),this.#U++}addStdFunctions(){let t="";for(let e of(this.#W=[...new Set(this.#W)],this.#W))C.hasOwnProperty(e)&&(t+=`const __${e} = ${C[e].toString()};
`);this.#Y=t+this.#Y}getSource(){return this.#Y}}function I(){let e=document.querySelectorAll('script[type="text/basescript"]'),s=new t,r=new a;for(let i of e){let n=s.tokenize(i.textContent);r.reset(n);let{ast:h}=r.parse("EOF"),o=new O(h);o.walk(),o.addStdFunctions();let l=document.createElement("script");l.type="text/javascript",l.textContent=o.getSource(),document.body.append(l)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){I()}):I()}();
